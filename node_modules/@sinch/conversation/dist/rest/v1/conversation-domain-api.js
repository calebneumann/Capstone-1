"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConversationDomainApi = void 0;
const sdk_client_1 = require("@sinch/sdk-client");
class ConversationDomainApi {
    constructor(sinchClientParameters, apiName) {
        this.sinchClientParameters = sinchClientParameters;
        this.apiName = apiName;
    }
    /**
     * Update the default hostname for the API
     * @param {string} hostname - The new hostname to use for the APIs.
     */
    setHostname(hostname) {
        try {
            this.client = this.getSinchClient();
            this.client.apiClientOptions.hostname = hostname;
        }
        catch (error) {
            console.error('Impossible to set a new hostname, the credentials need to be provided first.');
            throw error;
        }
    }
    /**
     * Update the region in the basePath
     * @param {ConversationRegion} region - The new region to send the requests to
     */
    setRegion(region) {
        this.sinchClientParameters.conversationRegion = region;
        if (this.client) {
            this.client.apiClientOptions.hostname = this.buildHostname(region);
        }
    }
    /**
     * Updates the credentials used to authenticate API requests
     * @param {UnifiedCredentials} credentials
     */
    setCredentials(credentials) {
        const parametersBackup = { ...this.sinchClientParameters };
        this.sinchClientParameters = {
            ...parametersBackup,
            ...credentials,
        };
        this.resetApiClient();
        try {
            this.getSinchClient();
        }
        catch (error) {
            console.error('Impossible to assign the new credentials to the Conversation API');
            this.sinchClientParameters = parametersBackup;
            throw error;
        }
    }
    resetApiClient() {
        this.client = undefined;
    }
    /**
     * Checks the configuration parameters are ok and initialize the API client. Once initialized, the same instance will
     * be returned for the subsequent API calls (singleton pattern)
     * @return {ApiClient} the API Client or throws an error in case the configuration parameters are not ok
     * @private
     */
    getSinchClient() {
        if (!this.client) {
            const region = this.sinchClientParameters.conversationRegion ?? sdk_client_1.ConversationRegion.UNITED_STATES;
            if (!Object.values(sdk_client_1.SupportedConversationRegion).includes(region)) {
                console.warn(`The region "${region}" is not known as a supported region for the Conversation API`);
            }
            const apiClientOptions = (0, sdk_client_1.buildOAuth2ApiClientOptions)(this.sinchClientParameters, 'Conversation');
            this.client = new sdk_client_1.ApiFetchClient(apiClientOptions);
            this.client.apiClientOptions.hostname = this.buildHostname(region);
        }
        return this.client;
    }
    buildHostname(region) {
        const formattedRegion = region !== '' ? `${region}.` : '';
        switch (this.apiName) {
            case 'TemplatesV1Api':
            case 'TemplatesV2Api':
                return this.sinchClientParameters.conversationTemplatesHostname
                    ?? (0, sdk_client_1.formatRegionalizedHostname)(sdk_client_1.CONVERSATION_TEMPLATES_HOSTNAME, formattedRegion);
            default:
                return this.sinchClientParameters.conversationHostname
                    ?? (0, sdk_client_1.formatRegionalizedHostname)(sdk_client_1.CONVERSATION_HOSTNAME, formattedRegion);
        }
    }
}
exports.ConversationDomainApi = ConversationDomainApi;
//# sourceMappingURL=conversation-domain-api.js.map